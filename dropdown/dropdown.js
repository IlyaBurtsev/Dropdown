!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Dropdown=e():t.Dropdown=e()}(this,(()=>(()=>{"use strict";var t,e={d:(t,s)=>{for(var n in s)e.o(s,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:s[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},s={};e.d(s,{default:()=>c}),function(t){t.onChangeState="onChangeState",t.changeState="changeState",t.onDestroy="onDestroy"}(t||(t={}));const n=t;var i;!function(t){t.addButtonClicked="addButtonClicked",t.subButtonClicked="subButtonClicked",t.changeTitle="changeTitle",t.changeItem="changeItem",t.init="init"}(i||(i={}));const o=i;function a(t,e,...s){const n=Object.keys(t);return s.filter((t=>t)).forEach((s=>{Object.entries(s).forEach((s=>{const[i,o]=s;void 0!==o&&(e||n.includes(i))&&(t[i]=o)}))})),t}function r(t,e,s){const n=s.target;return n===e||e.contains(n)||t.composed&&t.composedPath().shift()===e}class h extends class{constructor(){this.events=new Map}on(t,e){var s;if(this.events.get(t))null===(s=this.events.get(t))||void 0===s||s.add(e);else{const s=new Set;this.events.set(t,s.add(e))}}off(t,e){var s;0!==this.events.size&&this.events.get(t)&&(null===(s=this.events.get(t))||void 0===s||s.delete(e))}removeAllEvents(){this.events.clear()}trigger(t,...e){var s;0!==this.events.size&&this.events.get(t)&&(null===(s=this.events.get(t))||void 0===s||s.forEach((t=>{t(...e)})))}}{constructor(t,e){super(),this.getState=()=>{const{itemStates:t,title:e}=this.state,s=[];return t.forEach((t=>{const e=Object.assign(t);s.push(e)})),{itemStates:s,title:e}},this.closedDropdown=()=>{this.dropdownController.handleClosedDropdown()},this.changeState=t=>{this.state=this.dataController.changeState(this.state,t)},this.newTrigger=(t,...e)=>{this.trigger(t,...e)},this.getStateSubscriber=(t,e=!0)=>{e?this.on(n.onChangeState,t):this.off(n.onChangeState,t)},this.addOnDestroySubscriber=t=>{this.on(n.onDestroy,t)},this.onDestroy=()=>{this.removeAllEvents()},this.init(t,e),this.on(n.changeState,this.changeState),this.on(n.onDestroy,this.onDestroy),this.newTrigger(n.onChangeState,this.state,{changeType:o.init})}init(t,e){this.dataController=new class{constructor(t,e){this.options={autoClose:!0,titlePlaceholder:"",minValueItem:0,maxValueItem:100,startValues:0,itemNames:"item",incrementStep:1},this.actions={onClick:"click"},this.getActions=()=>this.actions,this.getNumberOfDefaultItems=()=>this.numberOfDefaultItems,this.autoClose=()=>{const{autoClose:t}=this.options;return t},this.changeState=(t,e)=>{const{changeType:s,id:i,title:r,itemParametrs:h}=e;let c;const{externalCheckState:l}=this.options;switch(s){case o.addButtonClicked:return void 0===i?t:(c=this.checkState(t,i,!0),void 0!==l&&(c=l(c,i,s)),this.trigger(n.onChangeState,c,e),c);case o.subButtonClicked:return void 0===i?t:(c=this.checkState(t,i,!1),void 0!==l&&(c=l(c,i,s)),this.trigger(n.onChangeState,c,e),c);case o.changeTitle:return void 0===r||(t.title=r,this.trigger(n.onChangeState,t,e)),t;case o.changeItem:{const{itemStates:o}=t;if(void 0===h||void 0===i)return t;let r=o[i];return r=a(r,!1,h),o[i]=this.checkItem(r),void 0!==l&&(t=l(t,i,s)),this.trigger(n.onChangeState,t,e),t}}return t},this.updateOptions=t=>{t&&(this.options=a(this.options,!0,t))},this.setNumberOfDefaultItems=()=>{const{itemNames:t}=this.options;return Array.isArray(t)?t.length:1},this.checkState=(t,e,s)=>{const{itemStates:n}=t,i=n[e],{incrementStep:o}=i;let{value:a}=i;return s?a+=o:a-=o,i.value=a,n[e]=this.checkItem(i),t},this.checkItem=t=>{const{minValue:e,maxValue:s}=t;let{value:n}=t;return n<e&&(t.value=e),n>s&&(t.value=s),t},this.initState=()=>{const{itemNames:t,startValues:e,minValueItem:s,maxValueItem:n,incrementStep:i,titlePlaceholder:a,externalCheckState:r}=this.options,h=[];let c={title:a,itemStates:h};if(Array.isArray(t))t.forEach(((a,l)=>{const u={itemName:a,minValue:s,maxValue:n,value:0,incrementStep:i};Array.isArray(e)?e.length===t.length?u.value=e[l]:u.value=0:u.value=e,h.push(u),void 0!==r&&(c=r(c,l,o.init))}));else{const a={itemName:t,minValue:s,maxValue:n,value:0,incrementStep:i};Array.isArray(e)?1===e.length&&([a.value]=e):a.value=e,h.push(a),void 0!==r&&(c=r(c,0,o.init))}return c},this.updateOptions(e),this.numberOfDefaultItems=this.setNumberOfDefaultItems(),this.trigger=t}}(this.newTrigger,e),this.dropdownController=new class{constructor(t){this.handleClosedDropdown=()=>{this.closedDropdown(),this.dropdown.blur()},this.onChangeState=(t,e)=>{const{changeType:s,title:n}=e;if(s===o.init){const{title:e}=t;this.setValueToInput(e)}else void 0!==n&&this.setValueToInput(n)},this.onFocus=t=>{const e=t.target;this.dropdown.contains(e)&&this.dropdown.focus(),this.openDropdown()},this.onBlur=t=>{const e=t.relatedTarget;this.dropdown.contains(e)?this.dropdown.focus():this.closedDropdown()};const{viewConnector:e,getEventNames:s,trigger:i,onChangeStateSubscriber:a,autoClose:h}=t,{dropdown:c,item:l,openDropdown:u,closedDropdown:d,setValueToInput:g}=e;this.dropdownListener=new class{constructor(t,e,s,i){this.onClickDropdown=t=>{let e;const s=function(t,e){if(0===t.type.indexOf("touch")){const e=Array.prototype.filter.call(t.touches,r);return!(e.length>1)&&e[0]}return!0}(t,(this.addButtonClassName,this.subButtonClassName));s&&(e=!0===s?t.target:s.target,this.detectEvent(e))},this.detectEvent=t=>{if(t.classList.contains(this.addButtonClassName)){const e={changeType:o.addButtonClicked};null!==t.getAttribute("id")&&(e.id=Number(t.getAttribute("id"))),this.trigger(n.changeState,e)}if(t.classList.contains(this.subButtonClassName)){const e={changeType:o.subButtonClicked};null!==t.getAttribute("id")&&(e.id=Number(t.getAttribute("id"))),this.trigger(n.changeState,e)}};const{addButtonClassName:a,subButtonClassName:h}=e;var c,l,u;this.addButtonClassName=a,this.subButtonClassName=h,this.eventNames=s,this.trigger=i,c=this.eventNames().onClick.split(" "),l=this.onClickDropdown,u=t,c.forEach((t=>u.addEventListener(t,l,!1)))}}(c,l,s,i),this.dropdown=c,this.setValueToInput=g,this.onChangeStateSubscriber=a,this.openDropdown=u,this.closedDropdown=d,c.tabIndex=0,a(this.onChangeState),c.addEventListener("focusin",this.onFocus,!0),h&&c.addEventListener("blur",this.onBlur)}}({autoClose:this.dataController.autoClose(),viewConnector:t,getEventNames:this.dataController.getActions,trigger:this.newTrigger,onChangeStateSubscriber:this.getStateSubscriber}),this.defaultItemController=new class{constructor(t){this.initItems=t=>{const e=[],{numberOfItems:s}=t,{container:n,addButtonClassName:i,subButtonClassName:o}=this.item;e.push(n),n.querySelector(`.${i}`).setAttribute("id","0"),n.querySelector(`.${o}`).setAttribute("id","0");const a=document.createDocumentFragment();for(let t=1;t<s;t+=1){const s=n.cloneNode(!0);s.querySelector(`.${i}`).setAttribute("id",`${t}`),s.querySelector(`.${o}`).setAttribute("id",`${t}`),a.append(s),e.push(s)}return n.after(a),e},this.onChangeState=(t,e)=>{const{setValue:s,setItemName:n}=this.item,{itemStates:i}=t,{changeType:a,id:r}=e;if(a===o.init)this.itemElements.forEach(((t,e)=>{n(`${i[e].itemName}`,t),s(`${i[e].value}`,t)}));else if(void 0!==r){const t=this.itemElements[r];n(`${i[r].itemName}`,t),s(`${i[r].value}`,t)}},this.onDestroy=()=>{this.itemElements.forEach(((t,e)=>{e>=1&&t.remove()}))};const{onDestroySubscriber:e,onChangeStateSubscriber:s,viewConnector:n}=t,{item:i}=n;this.item=i,this.itemElements=this.initItems(t),s(this.onChangeState),e(this.onDestroy)}}({viewConnector:t,numberOfItems:this.dataController.getNumberOfDefaultItems(),onDestroySubscriber:this.addOnDestroySubscriber,onChangeStateSubscriber:this.getStateSubscriber}),this.state=this.dataController.initState()}}const c=(t,e)=>{const s=t,i=new Map;let r=e,c=new h(s,e);return{updateDropdownOptions:t=>{r=void 0!==r?a(r,!0,t):t,c.trigger(n.onDestroy),c=new h(s,r),i.forEach(((t,e)=>c.on(e,t)))},changeTitle:t=>{const e={changeType:o.changeTitle,title:t};c.trigger(n.changeState,e)},changeItemParametrs:(t,e)=>{const s={changeType:o.changeItem,id:e,itemParametrs:t};c.trigger(n.changeState,s)},subscribeToChangeState:(t,e=!0)=>{e?(c.on(n.onChangeState,t),i.set(n.onChangeState,t)):c.off(n.onChangeState,t)},closedDropdown:c.closedDropdown}};return s.default})()));